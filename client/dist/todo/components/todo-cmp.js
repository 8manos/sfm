"use strict";var __decorate=this&&this.__decorate||function(e,o,t,i){var s,n=arguments.length,r=n<3?o:null===i?i=Object.getOwnPropertyDescriptor(o,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,o,t,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(r=(n<3?s(r):n>3?s(o,t,r):s(o,t))||r);return n>3&&r&&Object.defineProperty(o,t,r),r},__metadata=this&&this.__metadata||function(e,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,o)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),todo_service_1=require("../services/todo-service"),geolocation_service_1=require("../services/geolocation-service");require("aws-sdk/dist/aws-sdk");var TodoCmp=function(){function e(e,o,t){this._todoService=e,this.geolocation=o,this.zone=t,this.title="UNAUTHORIZED SFMOMA SHOW",this.file_url="",this.inmoma=!1,this.item={todoMessage:0,createdAt:0,todoArtwork:0,todoDate:0,todoMedium:0,todoSize:0,todoArtist:0,todoEmail:0,file_url:0},this.submiting=!1,this.viewing=!1,this.todos=[],this.isClassVisible=!1,this.center="Undisclosed Location",this.todoForm={todoMessage:""}}return e.prototype.ngOnInit=function(){this._getAll(),this.getCurrentPosition()},e.prototype._getAll=function(){var e=this;this._todoService.getAll().subscribe(function(o){console.log("Todos: ",o),e.zone.run(function(){console.log("Got item: ",o),e.item=o})})},e.prototype.fileEvent=function(e){var o=e.target.files,t=o[0];this.file=t,console.log("Selected file: ",this.file)},e.prototype.submit=function(){this.submiting=!0,this.viewing=!1,this.isClassVisible=!0},e.prototype.view=function(){this.submiting=!1,this.viewing=!0,this.isClassVisible=!0},e.prototype.reset=function(){this.submiting=!1,this.viewing=!1,this.isClassVisible=!1},e.prototype.add=function(e){var o=window.AWS;console.log(o);var t=this.file;o.config.accessKeyId="AKIAJGBCGJ455OKL6PIQ",o.config.secretAccessKey="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";var i=new o.S3({params:{Bucket:"sfmomashow"}}),s={Key:t.name,Body:t},n=this;i.upload(s,function(o,t){o?console.log("error: ",o):(console.log("response: ",t),e.file_url=t.Location,n._todoService.add(e).subscribe(function(e){console.log("m: ",e),n.zone.run(function(){console.log("added: ",e),n.item=e,n.view()})}))})},e.prototype.remove=function(e){var o=this;this._todoService.remove(e).subscribe(function(){o.todos.forEach(function(t,i){if(t._id===e)return o.todos.splice(i,1)})})},e.prototype.getCurrentPosition=function(){var e=this;this.located=!1,this.warning=!1,this.message="",navigator.geolocation?(console.log("Getting position"),this.geolocation.getCurrentPosition().forEach(function(o){e.center=o.coords.latitude+", "+o.coords.longitude,e.zoom="11",e.message="",e.warning=!1,e.located=!0,e.distance=e.getDistance(o.coords.latitude,o.coords.longitude,"37.785665","-122.400502"),e.distance<145e3&&(e.inmoma=!0)},null).then(function(){return console.log("Geolocation service: completed.")})["catch"](function(o){if(o.code>0){switch(o.code){case o.PERMISSION_DENIED:e.message="permission denied";break;case o.POSITION_UNAVAILABLE:e.message="position unavailable";break;case o.TIMEOUT:e.message="position timeout"}e.warning=!0}})):(this.message="browser doesn't support geolocation",this.warning=!0)},e.prototype.getDistance=function(e,o,t,i){var s=.017453292519943295,n=Math.cos,r=.5-n((t-e)*s)/2+n(e*s)*n(t*s)*(1-n((i-o)*s))/2;return 12742*Math.asin(Math.sqrt(r))},e}();TodoCmp=__decorate([core_1.Component({selector:"todo-cmp",templateUrl:"todo/templates/todo.html",styleUrls:["todo/styles/todo.css"]}),__metadata("design:paramtypes",[todo_service_1.TodoService,geolocation_service_1.GeolocationService,core_1.NgZone])],TodoCmp),exports.TodoCmp=TodoCmp;